<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AudioWEB PRO (BETA) - VERSÃO TESTE </title>
<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={theme:{extend:{colors:{medical:{50:'#f0fdfa',100:'#ccfbf1',500:'#14b8a6',600:'#0d9488',700:'#0f766e',800:'#115e59',900:'#134e4a'}},screens:{'print':{'raw':'print'}}}}}</script>
<script type="importmap">{"imports":{"react":"https://esm.sh/react@18.2.0","react-dom/client":"https://esm.sh/react-dom@18.2.0/client","lucide-react":"https://esm.sh/lucide-react@0.263.1"}}</script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');body{font-family:'Inter',sans-serif;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}input,textarea,select{user-select:text}@media print{@page{margin:0.5cm;size:A4}body{background:#fff;-webkit-print-color-adjust:exact;print-color-adjust:exact}.no-print{display:none!important}.print-only{display:block!important}input,textarea,select{border:none!important;resize:none;background:0 0;padding:0;appearance:none}::-webkit-input-placeholder{color:transparent}svg{break-inside:avoid}.page-break-inside-avoid{break-inside:avoid}.print-container{min-height:290mm;display:flex;flex-direction:column;justify-content:space-between}.print-footer{margin-top:auto;width:100%}}.print-only{display:none}.modal-overlay{background-color:rgba(15,23,42,.6);backdrop-filter:blur(4px)}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:0 0}::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}::-webkit-scrollbar-thumb:hover{background:#94a3b8}
</style>
<script>
/* Security Layer - GFR */
document.addEventListener('contextmenu',e=>e.preventDefault());document.onkeydown=function(e){if(123==e.keyCode||e.ctrlKey&&e.shiftKey&&73==e.keyCode||e.ctrlKey&&e.shiftKey&&67==e.keyCode||e.ctrlKey&&e.shiftKey&&74==e.keyCode||e.ctrlKey&&85==e.keyCode)return!1};
</script>
</head>
<body class="bg-slate-50 text-slate-700 antialiased">
<div id="root"></div>
<script type="text/babel" data-type="module">
import React,{useState,useEffect,useMemo}from'react';import{createRoot}from'react-dom/client';import{Ear,RotateCcw,Activity,Bone,Mic2,Waves,FileText,Printer,AlertTriangle,User,Calendar,Settings,Clipboard,Calculator,X,BarChart3,CheckSquare,Square,ArrowDown,Stethoscope,BookOpen,MoveHorizontal,MoveLeft,MoveRight,SlidersHorizontal,ArrowDownLeft,Lock,ShieldCheck}from'lucide-react';

const TermsModal = ({ onAgree }) => (
  <div className="fixed inset-0 z-[9999] bg-slate-900 flex items-center justify-center p-4">
    <div className="bg-white rounded-xl shadow-2xl max-w-lg w-full p-8 border-t-8 border-red-600 animate-in fade-in zoom-in duration-300">
      <div className="flex justify-center mb-4"><div className="bg-red-100 p-3 rounded-full"><Lock className="w-8 h-8 text-red-600"/></div></div>
      <h1 className="text-2xl font-bold text-slate-800 mb-2 text-center">AVISO LEGAL DE TESTE</h1>
      <p className="text-center text-slate-500 text-sm mb-6 uppercase tracking-wide font-bold">Versão Beta - Uso Restrito</p>
      <div className="bg-slate-50 p-5 rounded-lg border border-slate-200 text-slate-700 mb-6">
        <p className="mb-3 text-sm">Você está acessando uma versão de <strong>demonstração técnica</strong> do AudioWEB PRO.</p>
        <div className="bg-white p-3 rounded border border-slate-200 shadow-sm mb-3">
          <p className="text-xs font-bold text-slate-500 uppercase mb-1">Propriedade Intelectual</p>
          <p className="text-sm font-bold text-slate-900">Este produto pertence exclusivamente a<br/><span className="text-medical-700">GIULLIA FERREIRA RODRIGUES</span>.</p>
        </div>
        <ul className="list-disc pl-4 space-y-1 text-xs text-slate-500 text-justify">
          <li>O uso comercial desta versão é <strong>estritamente proibido</strong>.</li>
          <li>Dados inseridos não são salvos permanentemente.</li>
          <li>A engenharia reversa ou cópia deste código é ilegal.</li>
        </ul>
      </div>
      <button onClick={onAgree} className="w-full py-4 bg-slate-900 hover:bg-slate-800 text-white font-bold rounded-lg transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2 group"><ShieldCheck size={20} className="group-hover:text-green-400 transition-colors"/> LI E CONCORDO COM OS TERMOS</button>
      <div className="mt-6 text-center text-[10px] text-slate-400 uppercase tracking-widest">© {new Date().getFullYear()} Giullia Ferreira Rodrigues<br/>Todos os direitos reservados</div>
    </div>
  </div>
);

const PrintOptionsModal = ({ onClose }) => {
  const [printConfig, setPrintConfig] = useState({tonal:true,logo:true,immitance:true,weber:true,report:true});
  return (
    <div className="fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4">
      <div className="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 transform transition-all scale-100">
        <h3 className="text-xl font-bold mb-5 flex items-center gap-2 text-medical-800 border-b pb-3 border-slate-100"><Printer className="w-5 h-5 text-medical-600"/> Opções de Impressão</h3>
        <div className="space-y-4 mb-8">
          {Object.keys(printConfig).map(key=>(
            <label key={key} className="flex items-center gap-3 cursor-pointer p-2 hover:bg-medical-50 rounded-lg transition-colors border border-transparent hover:border-medical-100">
              <input type="checkbox" checked={printConfig[key]} onChange={e=>setPrintConfig({...printConfig,[key]:e.target.checked})} className="w-5 h-5 accent-medical-600 rounded cursor-pointer"/>
              <span className="text-sm font-medium text-slate-700 capitalize">{key==='report'?'Laudo / Obs':key==='tonal'?'Audiometria Tonal':key==='logo'?'Logoaudiometria':key==='immitance'?'Imitanciometria':key==='weber'?'Teste de Weber':key}</span>
            </label>
          ))}
        </div>
        <div className="flex gap-3">
          <button onClick={onClose} className="flex-1 py-2.5 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-lg transition-colors">Cancelar</button>
          <button onClick={()=>{onClose();setTimeout(()=>window.print(),100)}} className="flex-1 py-2.5 text-sm text-white bg-medical-600 hover:bg-medical-700 rounded-lg font-semibold shadow-md transition-all hover:shadow-lg">Gerar PDF</button>
        </div>
      </div>
    </div>
  );
};

const AudiogramApp = () => {
  const [termsAccepted, setTermsAccepted] = useState(false);
  const [patientData, setPatientData] = useState({name:'',dob:'',age:'',gender:'',examDate:new Date().toISOString().split('T')[0]});
  const [equipmentData, setEquipmentData] = useState({audiometerModel:'',audiometerCalib:'',immitanceModel:'',immitanceCalib:''});
  const [professionalData, setProfessionalData] = useState({name:'',crfa:''});
  const [clinicalNotes, setClinicalNotes] = useState({laudo:'',observations:''});
  const [printConfig, setPrintConfig] = useState({tonal:true,logo:true,immitance:true,weber:true,report:true});
  const [activeModal, setActiveModal] = useState(null);
  const [showIntermediates, setShowIntermediates] = useState(false);
  const allFrequencies = [125,250,500,750,1000,1500,2000,3000,4000,6000,8000];
  const standardFrequencies = [125,250,500,1000,2000,3000,4000,6000,8000];
  const currentFrequencies = useMemo(()=>showIntermediates?allFrequencies:standardFrequencies,[showIntermediates]);
  const boneFrequencies = [500,750,1000,1500,2000,3000,4000];
  const weberFrequencies = [500,1000,2000,3000,4000];
  const createEmptyFreqData = () => allFrequencies.reduce((acc,freq)=>({...acc,[freq]:null}),{});
  const [rightAir, setRightAir] = useState(createEmptyFreqData());
  const [leftAir, setLeftAir] = useState(createEmptyFreqData());
  const [rightBone, setRightBone] = useState(createEmptyFreqData());
  const [leftBone, setLeftBone] = useState(createEmptyFreqData());
  const [maskedPoints, setMaskedPoints] = useState({rightAir:{},leftAir:{},rightBone:{},leftBone:{}});
  const [noResponsePoints, setNoResponsePoints] = useState({rightAir:{},leftAir:{},rightBone:{},leftBone:{}});
  const [weberData, setWeberData] = useState(weberFrequencies.reduce((acc,f)=>({...acc,[f]:''}),{}));
  const [logoData, setLogoData] = useState({right:{srt:'',sdt:'',masking:'',ipfrMono:'',ipfrMonoLevel:'',ipfrDi:'',ipfrDiLevel:''},left:{srt:'',sdt:'',masking:'',ipfrMono:'',ipfrMonoLevel:'',ipfrDi:'',ipfrDiLevel:''}});
  const [immitanceData, setImmitanceData] = useState({right:{pressure:'',peakVol:'',vol200:''},left:{pressure:'',peakVol:'',vol200:''},reflexes:{right:{contra:{500:'',1000:'',2000:'',4000:''},ipsi:{500:'',1000:'',2000:'',4000:''},threshold:{500:'',1000:'',2000:'',4000:''}},left:{contra:{500:'',1000:'',2000:'',4000:''},ipsi:{500:'',1000:'',2000:'',4000:''},threshold:{500:'',1000:'',2000:'',4000:''}}}});
  const [activeEar, setActiveEar] = useState('right');
  const [stimulusType, setStimulusType] = useState('air');
  const [maskingMode, setMaskingMode] = useState(false);
  const [noResponseMode, setNoResponseMode] = useState(false);
  const [activeTab, setActiveTab] = useState('tonal');

  const parseNum = (val) => {if(!val&&val!==0)return null;const num=parseFloat(val.toString().replace(',','.'));return isNaN(num)?null:num};
  const formatDate = (dateString) => {if(!dateString)return'';const date=new Date(dateString);const userTimezoneOffset=date.getTimezoneOffset()*60000;return new Date(date.getTime()+userTimezoneOffset).toLocaleDateString('pt-BR')};
  
  useEffect(() => {
    if(patientData.dob){const birthDate=new Date(patientData.dob);const today=new Date();let age=today.getFullYear()-birthDate.getFullYear();const m=today.getMonth()-birthDate.getMonth();if(m<0||(m===0&&today.getDate()<birthDate.getDate()))age--;setPatientData(prev=>({...prev,age:age}))}
  }, [patientData.dob]);

  const width = 350; const height = 350; const padding = {top:40,right:20,bottom:40,left:40};
  const graphWidth = width-padding.left-padding.right; const graphHeight = height-padding.top-padding.bottom;
  const minDb = -10; const maxDb = 120;
  const getX = (freqIndex) => padding.left+(freqIndex*(graphWidth/(currentFrequencies.length-1)));
  const getY = (db) => padding.top+((db-minDb)/(maxDb-minDb))*graphHeight;
  const getDbFromY = (y) => {const relativeY=y-padding.top;const db=(relativeY/graphHeight)*(maxDb-minDb)+minDb;return Math.round(db/5)*5};
  
  const isFreqAbsent = (earData, freq, ear, type) => {const key=(ear==='right'?'right':'left')+(type==='air'?'Air':'Bone');return noResponsePoints[key]?.[freq]||false};
  
  const calculateAverage = (earData, freqsToAvg, ear, type='air') => {
    const values=[];for(let f of freqsToAvg){const isAbsent=isFreqAbsent(earData,f,ear,type);if(earData[f]===null&&!isAbsent)return null;if(isAbsent){values.push(earData[f]||120)}else{values.push(earData[f])}}
    const sum=values.reduce((a,b)=>a+b,0);return sum/values.length;
  };
  const calculateWHO2021_Average = (earData,ear) => calculateAverage(earData,[500,1000,2000,4000],ear);
  const calculateTritonal_Average = (earData,ear) => calculateAverage(earData,[500,1000,2000],ear);
  const getWHO2021_Classification = (avg) => {if(avg===null)return"Incompleto";if(avg<20)return"Audição Normal";if(avg<35)return"Perda Leve";if(avg<50)return"Perda Moderada";if(avg<65)return"Mod. Severa";if(avg<80)return"Perda Severa";if(avg<95)return"Perda Profunda";return"Perda Completa/Surdez"};
  const getTympanometryType = (pressureVal,staticCompVal) => {const p=parseNum(pressureVal);const sc=parseNum(staticCompVal);if(p===null||sc===null)return"Dados Insuficientes";if(p<-100)return"Tipo C";if(p>=-100){if(sc<0.30)return"Tipo As";if(sc>1.65)return"Tipo Ad";return"Tipo A"}if(sc<0.2&&(p===null||Math.abs(p)>200))return"Sugestivo de Tipo B";return"Indeterminado"};

  const updateTonalPoint = (ear, type, freq, value, isMaskedInput=false, isNoResponseInput=false) => {
    let numValue=value===''?null:Number(value);if(numValue!==null){if(numValue>120)numValue=120;if(numValue<-10)numValue=-10}
    const setters={'right-air':setRightAir,'left-air':setLeftAir,'right-bone':setRightBone,'left-bone':setLeftBone};
    const sources={'right-air':rightAir,'left-air':leftAir,'right-bone':rightBone,'left-bone':leftBone};
    const key=`${ear}-${type}`;setters[key]({...sources[key],[freq]:numValue});
    const maskKey=(ear==='right'?'right':'left')+(type==='air'?'Air':'Bone');
    setMaskedPoints(prev=>({...prev,[maskKey]:{...prev[maskKey],[freq]:isMaskedInput}}));
    setNoResponsePoints(prev=>({...prev,[maskKey]:{...prev[maskKey],[freq]:isNoResponseInput}}));
  };

  const handleGraphClick = (e, targetEar) => {
    const svg=e.currentTarget;const rect=svg.getBoundingClientRect();const scaleX=width/rect.width;const scaleY=height/rect.height;const actualX=(e.clientX-rect.left)*scaleX;const actualY=(e.clientY-rect.top)*scaleY;let closestFreqIndex=0;let minDiff=Infinity;
    currentFrequencies.forEach((freq,index)=>{const diff=Math.abs(getX(index)-actualX);if(diff<minDiff){minDiff=diff;closestFreqIndex=index}});
    if(minDiff>50)return;const freq=currentFrequencies[closestFreqIndex];if(stimulusType==='bone'&&!boneFrequencies.includes(freq))return;
    let db=getDbFromY(actualY);if(db<minDb)db=minDb;if(db>maxDb)db=maxDb;
    updateTonalPoint(targetEar,stimulusType,freq,db,maskingMode,noResponseMode);
  };

  const updateWeber = (freq, direction) => { setWeberData(prev=>({...prev,[freq]:direction})) };
  
  const resetAll = () => {
    if(confirm('Limpar todos os dados clínicos?')){
      setPatientData(prev=>({...prev,gender:''}));setRightAir(createEmptyFreqData());setLeftAir(createEmptyFreqData());setRightBone(createEmptyFreqData());setLeftBone(createEmptyFreqData());
      setMaskedPoints({rightAir:{},leftAir:{},rightBone:{},leftBone:{}});setNoResponsePoints({rightAir:{},leftAir:{},rightBone:{},leftBone:{}});
      setWeberData(weberFrequencies.reduce((acc,f)=>({...acc,[f]:''}),{}));
      setImmitanceData({right:{pressure:'',peakVol:'',vol200:''},left:{pressure:'',peakVol:'',vol200:''},reflexes:{right:{contra:{500:'',1000:'',2000:'',4000:''},ipsi:{500:'',1000:'',2000:'',4000:''},threshold:{500:'',1000:'',2000:'',4000:''}},left:{contra:{500:'',1000:'',2000:'',4000:''},ipsi:{500:'',1000:'',2000:'',4000:''},threshold:{500:'',1000:'',2000:'',4000:''}}}});
      setLogoData({right:{srt:'',sdt:'',masking:'',ipfrMono:'',ipfrMonoLevel:'',ipfrDi:'',ipfrDiLevel:''},left:{srt:'',sdt:'',masking:'',ipfrMono:'',ipfrMonoLevel:'',ipfrDi:'',ipfrDiLevel:''}});
    }
  };

  const AdvancedCalculator = ({ onClose, initialTab='masking' }) => {
    const [modalTab, setModalTab] = useState(initialTab);
    const getMaskingInfo = (freq, ear, type) => {
      const teAir=ear==='right'?rightAir[freq]:leftAir[freq];const teBone=ear==='right'?rightBone[freq]:leftBone[freq];const nteAir=ear==='right'?leftAir[freq]:rightAir[freq];const nteBone=(ear==='right'?leftBone[freq]:rightBone[freq])||nteAir||0;const oeMap={250:15,500:15,750:15,1000:10};const oe=oeMap[freq]||0;
      if(teAir===null)return null;
      if(type==='bone'){if(teBone!==null&&(teAir-teBone)>10)return{needed:true,value:(nteAir||0)+oe+10,reason:`Gap A-O > 10dB`}}
      if(type==='air'){if((teAir-(nteBone||0))>=40)return{needed:true,value:(nteAir||0)+10,reason:`Atenuação IA ≥ 40dB`}}
      return{needed:false}
    };
    const getSpeechMasking = (ear, test) => {
      let valStr;let isIpfr=false;if(test==='SRT')valStr=logoData[ear].srt;else if(test==='SDT')valStr=logoData[ear].sdt;else if(test==='IPRF (Mono)'){valStr=logoData[ear].ipfrMonoLevel;isIpfr=true}else if(test==='IPRF (Dissí)'){valStr=logoData[ear].ipfrDiLevel;isIpfr=true}
      const val=parseNum(valStr);if(val===null)return null;const nteEar=ear==='right'?'left':'right';const nteBoneData=nteEar==='right'?rightBone:leftBone;const nteAirData=nteEar==='right'?rightAir:leftAir;let bestBone=120;let hasBone=false;
      [500,750,1000,1500,2000,3000,4000].forEach(f=>{if(nteBoneData[f]!==null&&nteBoneData[f]<bestBone){bestBone=nteBoneData[f];hasBone=true}});if(!hasBone){const pta=calculateWHO2021_Average(nteAirData,nteEar);bestBone=pta!==null?pta:0}
      if((val-40)>=bestBone){const nteSrt=parseNum(logoData[nteEar].srt)||0;if(isIpfr)return{needed:true,value:val-40+10,reason:'Nível (TE) - 40 ≥ VO (NTE)'};return{needed:true,value:nteSrt+10,reason:'SRT (TE) - 40 ≥ VO (NTE)'}}return{needed:false}
    };
    const getDiagnosis = (ear) => {
      const airData=ear==='right'?rightAir:leftAir;const boneData=ear==='right'?rightBone:leftBone;const pta=calculateWHO2021_Average(airData,ear);if(pta===null)return{degree:'Incompleto',type:'Incompleto'};const degree=getWHO2021_Classification(pta);let type='Normal';
      if(degree!=='Audição Normal'){let gapSum=0,gapCount=0,boneAbnormalCount=0;[500,1000,2000,4000].forEach(f=>{if(airData[f]!==null&&boneData[f]!==null){const gap=airData[f]-boneData[f];gapSum+=gap;gapCount++;if(boneData[f]>25)boneAbnormalCount++}});const avgGap=gapCount>0?gapSum/gapCount:0;if(avgGap<=10)type='Neurossensorial';else{if(boneAbnormalCount===0)type='Condutiva';else type='Mista'}}return{degree,type}
    };
    const diagR=getDiagnosis('right');const diagL=getDiagnosis('left');
    const getImmitanceDiag = (side) => {const vPeak=parseNum(immitanceData[side].peakVol);const v200=parseNum(immitanceData[side].vol200);const pressure=parseNum(immitanceData[side].pressure);const statComp=(vPeak&&v200)?(vPeak-v200).toFixed(2):null;return getTympanometryType(pressure,statComp)};
    
    return (
      <div className="fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4">
        <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col border border-slate-200">
          <div className="p-5 border-b border-slate-100 flex justify-between items-center bg-white rounded-t-2xl"><h2 className="text-xl font-bold text-slate-800 flex items-center gap-2"><Calculator className="w-6 h-6 text-medical-600"/> Assistente de Análise</h2><button onClick={onClose} className="p-2 hover:bg-slate-100 rounded-full text-slate-400 hover:text-slate-600 transition-colors"><X className="w-5 h-5"/></button></div>
          <div className="flex border-b border-slate-200 bg-slate-50/50"><button onClick={()=>setModalTab('masking')} className={`flex-1 py-4 text-sm font-semibold transition-colors ${modalTab==='masking'?'text-medical-700 border-b-2 border-medical-600 bg-white':'text-slate-500 hover:text-slate-700'}`}>Calculadora de Mascaramento</button><button onClick={()=>setModalTab('diagnosis')} className={`flex-1 py-4 text-sm font-semibold transition-colors ${modalTab==='diagnosis'?'text-medical-700 border-b-2 border-medical-600 bg-white':'text-slate-500 hover:text-slate-700'}`}>Sugestão de Diagnóstico</button></div>
          <div className="p-8 overflow-y-auto bg-slate-50/30">
            {modalTab==='masking'&&(<div className="grid grid-cols-1 md:grid-cols-2 gap-8">{['right','left'].map(ear=>(<div key={ear} className="space-y-5"><h3 className={`text-sm font-bold uppercase tracking-wider border-b pb-2 mb-3 flex items-center gap-2 ${ear==='right'?'text-red-600 border-red-200':'text-blue-600 border-blue-200'}`}><Ear size={16} className={ear==='left'?'scale-x-[-1]':''}/> Orelha {ear==='right'?'Direita':'Esquerda'}</h3><div className="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden"><div className="bg-slate-50 px-4 py-2 text-xs font-bold text-slate-500 uppercase border-b border-slate-100">Tonal (NB)</div><table className="w-full text-sm"><thead className="bg-white text-slate-400 text-xs"><tr><th className="py-2 font-medium">Hz</th><th className="font-medium">Via</th><th className="font-medium">Limiar</th><th className="font-medium">Masc.</th></tr></thead><tbody className="divide-y divide-slate-50">{currentFrequencies.map(f=>{const infoAir=getMaskingInfo(f,ear,'air');const infoBone=getMaskingInfo(f,ear,'bone');const rows=[];if(infoAir&&infoAir.needed)rows.push(<tr key={`${f}-air`}><td className="py-1 text-center font-medium text-slate-600">{f}</td><td className="text-center text-slate-500">VA</td><td className="text-center">{ear==='right'?rightAir[f]:leftAir[f]}</td><td className="text-center font-bold text-amber-600 bg-amber-50">{infoAir.value}</td></tr>);if(infoBone&&infoBone.needed)rows.push(<tr key={`${f}-bone`}><td className="py-1 text-center font-medium text-slate-600">{f}</td><td className="text-center text-slate-500">VO</td><td className="text-center">{ear==='right'?rightBone[f]:leftBone[f]}</td><td className="text-center font-bold text-amber-600 bg-amber-50">{infoBone.value}</td></tr>);return rows})}</tbody></table></div><div className="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden"><div className="bg-slate-50 px-4 py-2 text-xs font-bold text-slate-500 uppercase border-b border-slate-100">Logoaudiometria</div><table className="w-full text-sm"><thead className="bg-white text-slate-400 text-xs"><tr><th className="py-2 font-medium">Teste</th><th className="font-medium">dB</th><th className="font-medium">Masc.</th></tr></thead><tbody className="divide-y divide-slate-50">{['SRT','SDT','IPRF (Mono)','IPRF (Dissí)'].map(test=>{const info=getSpeechMasking(ear,test);let val='';if(test==='SRT')val=logoData[ear].srt;else if(test==='SDT')val=logoData[ear].sdt;else if(test==='IPRF (Mono)')val=logoData[ear].ipfrMonoLevel;else val=logoData[ear].ipfrDiLevel;if(!info&&!val)return null;return(<tr key={test}><td className="py-1 text-center font-medium text-slate-600">{test}</td><td className="text-center text-slate-600">{val}</td><td className="text-center font-bold text-amber-600 bg-amber-50">{info?.needed?info.value:'-'}</td></tr>)})}</tbody></table></div></div>))}</div>)}
            {modalTab==='diagnosis'&&(<div className="space-y-8"><div className="grid grid-cols-1 md:grid-cols-2 gap-8">{[{ear:'right',data:diagR,label:'Direita',color:'red',ring:'ring-red-100'},{ear:'left',data:diagL,label:'Esquerda',color:'blue',ring:'ring-blue-100'}].map(({ear,data,label,color,ring})=>(<div key={ear} className={`bg-white rounded-xl p-6 shadow-sm border border-slate-100 ring-4 ${ring}`}><h3 className={`text-lg font-bold text-${color}-600 mb-6 flex items-center gap-2 uppercase tracking-wide`}><Ear className={`w-5 h-5 ${ear==='left'?'scale-x-[-1]':''}`}/> {label}</h3><div className="space-y-4"><div className="flex justify-between items-center p-3 bg-slate-50 rounded-lg border border-slate-100"><span className="text-xs font-bold text-slate-500 uppercase">Média (500-4k)</span><span className="text-xl font-bold text-slate-800">{ear==='right'?calculateWHO2021_Average(rightAir,ear)?.toFixed(1):calculateWHO2021_Average(leftAir,ear)?.toFixed(1)} <span className="text-xs font-normal text-slate-400">dB</span></span></div><div className="flex justify-between items-center p-3 bg-slate-50 rounded-lg border border-slate-100"><span className="text-xs font-bold text-slate-500 uppercase">Grau (OMS 21)</span><span className={`text-base font-bold text-${color}-600`}>{data.degree}</span></div><div className="flex justify-between items-center p-3 bg-slate-50 rounded-lg border border-slate-100"><span className="text-xs font-bold text-slate-500 uppercase">Tipo</span><span className={`text-base font-bold text-${color}-600`}>{data.type}</span></div><div className="flex justify-between items-center p-3 bg-slate-50 rounded-lg border border-slate-100"><span className="text-xs font-bold text-slate-500 uppercase">Curva Timpanométrica</span><span className={`text-base font-bold text-${color}-600`}>{getImmitanceDiag(ear)}</span></div></div></div>))}</div><div className="bg-amber-50 border border-amber-200 rounded p-4 text-xs text-amber-800 flex gap-2"><AlertTriangle className="w-4 h-4 shrink-0 mt-0.5"/><div><strong>Nota Importante:</strong> O diagnóstico apresentado é uma sugestão computacional baseada nos limiares inseridos.<ul><li>- <strong>Grau:</strong> Baseado na classificação da OMS (2021) pela média de 500, 1k, 2k e 4k Hz. Frequências ausentes não são contabilizadas.</li><li>- <strong>Tipo:</strong> Analisa a relação entre Via Aérea e Via Óssea (Gap Aéreo-Ósseo médio).</li><li>- <strong>Curvas:</strong> Classificação sugerida baseada em Jerger (1970/1972) conforme Guia CFFa.</li></ul> A validação clínica final é responsabilidade exclusiva do fonoaudiólogo.</div></div></div>)}
          </div>
        </div>
      </div>
    );
  };

  const TympanogramGraph = ({ dataR, dataL }) => {
    const w = 300, h = 180; const pX = 35, pY = 20;
    const mapX = (d) => pX+((d-(-400))/(600))*(w-2*pX);
    const mapY = (m) => (h-pY)-(m/1.5)*(h-2*pY);
    const genPath = (peakPressure, peakVol, vol200) => {
      const p=parseNum(peakPressure);const vPeak=parseNum(peakVol);const v200=parseNum(vol200);if(p===null||vPeak===null||v200===null)return"";
      const height=Math.max(0,vPeak-v200);const base=v200;let path="";for(let x=-400;x<=200;x+=5){const yVal=base+height*Math.exp(-Math.pow(x-p,2)/(2*Math.pow(50,2)));const drawY=Math.min(Math.max(yVal,0),1.5);path+=(x===-400?"M":"L")+` ${mapX(x)} ${mapY(drawY)}`}return path;
    };
    return (
      <svg viewBox={`0 0 ${w} ${h}`} className="w-full h-full bg-white border border-slate-200 rounded-lg shadow-sm">
        <rect x={pX} y={pY} width={w-2*pX} height={h-2*pY} fill="#f8fafc" />
        {[-400,-200,0,200].map(v=>(<g key={v}><line x1={mapX(v)} y1={pY} x2={mapX(v)} y2={h-pY} stroke="#e2e8f0" strokeDasharray="3 3" /><text x={mapX(v)} y={h-5} textAnchor="middle" fontSize="9" fill="#94a3b8" fontWeight="500">{v}</text></g>))}
        {[0.5,1.0,1.4].map(v=>(<g key={v}><line x1={pX} y1={mapY(v)} x2={w-pX} y2={mapY(v)} stroke="#e2e8f0" strokeDasharray="3 3" /><text x={pX-5} y={mapY(v)+3} textAnchor="end" fontSize="9" fill="#94a3b8" fontWeight="500">{v}</text></g>))}
        <path d={genPath(dataR.pressure,dataR.peakVol,dataR.vol200)} fill="rgba(239, 68, 68, 0.1)" stroke="#ef4444" strokeWidth="2.5" strokeLinecap="round" />
        <path d={genPath(dataL.pressure,dataL.peakVol,dataL.vol200)} fill="rgba(37, 99, 235, 0.1)" stroke="#2563eb" strokeWidth="2.5" strokeLinecap="round" />
        <text x={w/2} y={12} textAnchor="middle" fontSize="10" fill="#64748b" fontWeight="600" style={{textTransform:'uppercase',letterSpacing:'0.05em'}}>Pressão (dPa)</text>
        <text transform={`rotate(-90 ${12} ${h/2})`} x={12} y={h/2} textAnchor="middle" fontSize="10" fill="#64748b" fontWeight="600" style={{textTransform:'uppercase',letterSpacing:'0.05em'}}>Volume (ml)</text>
      </svg>
    );
  };

  const SingleAudiogramGraph = ({ ear, isPrint=false }) => {
    const isRight=ear==='right';const boneData=isRight?rightBone:leftBone;const airData=isRight?rightAir:leftAir;const maskKeyAir=isRight?'rightAir':'leftAir';const maskKeyBone=isRight?'rightBone':'leftBone';const noResponseKeyAir=isRight?'rightAir':'leftAir';const noResponseKeyBone=isRight?'rightBone':'leftBone';const color=isRight?'#ef4444':'#2563eb';const freqsToUse=currentFrequencies;
    const renderL = (d, c, type) => {
      let p="";let f=true;const dash=ear==='left'?"4 4":"0";
      for(let i=0;i<freqsToUse.length-1;i++){const freq1=freqsToUse[i];const freq2=freqsToUse[i+1];const val1=d[freq1];const val2=d[freq2];if(val1!==null&&val2!==null){const nrKey=type==='air'?noResponseKeyAir:noResponseKeyBone;const isNr1=noResponsePoints[nrKey][freq1];const isNr2=noResponsePoints[nrKey][freq2];if(!isNr1&&!isNr2){const x1=getX(i);const y1=getY(val1);const x2=getX(i+1);const y2=getY(val2);p+=`M ${x1} ${y1} L ${x2} ${y2} `}}}return<path d={p} fill="none" stroke={c} strokeWidth={isPrint?"2":"2"} strokeDasharray={dash} />
    };
    const renderS = (d, t) => freqsToUse.map((freq, i) => {
      if(d[freq]===null)return null;const x=getX(i),y=getY(d[freq]);const isMasked=(t==='air'?maskedPoints[maskKeyAir][freq]:maskedPoints[maskKeyBone][freq]);const isNoResponse=(t==='air'?noResponsePoints[noResponseKeyAir][freq]:noResponsePoints[noResponseKeyBone][freq]);
      let symbol;
      if(t==='air'){if(isMasked){symbol=isRight?<polygon points={`${x},${y-6} ${x-5},${y+4} ${x+5},${y+4}`} fill="none" stroke={color} strokeWidth="2" />:<rect x={x-4} y={y-4} width="8" height="8" fill="none" stroke={color} strokeWidth="2" />}else{symbol=isRight?<circle cx={x} cy={y} r={4} fill="white" stroke={color} strokeWidth="2" />:<g><line x1={x-3} y1={y-3} x2={x+3} y2={y+3} stroke={color} strokeWidth="2" /><line x1={x+3} y1={y-3} x2={x-3} y2={y+3} stroke={color} strokeWidth="2" /></g>}}else{if(isMasked){symbol=isRight?<path d={`M ${x+4} ${y-6} L ${x-2} ${y-6} L ${x-2} ${y+6} L ${x+4} ${y+6}`} fill="none" stroke={color} strokeWidth="2" />:<path d={`M ${x-4} ${y-6} L ${x+2} ${y-6} L ${x+2} ${y+6} L ${x-4} ${y+6}`} fill="none" stroke={color} strokeWidth="2" />}else{symbol=isRight?<path d={`M ${x+3} ${y-5} L ${x-2} ${y} L ${x+3} ${y+5}`} fill="none" stroke={color} strokeWidth="2" />:<path d={`M ${x-3} ${y-5} L ${x+2} ${y} L ${x-3} ${y+5}`} fill="none" stroke={color} strokeWidth="2" />}}
      if(isNoResponse){const arrowDir=isRight?-1:1;const arrowPath=`M ${x} ${y} L ${x+(arrowDir*8)} ${y+8}`;const arrowHead=isRight?`M ${x-8} ${y+8} L ${x-4} ${y+8} M ${x-8} ${y+8} L ${x-8} ${y+4}`:`M ${x+8} ${y+8} L ${x+4} ${y+8} M ${x+8} ${y+8} L ${x+8} ${y+4}`;return(<g key={i}>{symbol}<path d={arrowPath} stroke={color} strokeWidth="2" fill="none" /><path d={arrowHead} stroke={color} strokeWidth="2" fill="none" /></g>)}
      return <g key={i}>{symbol}</g>
    });
    return (
      <svg viewBox={`0 0 ${width} ${height}`} className={`w-full h-full bg-white ${!isPrint?'cursor-crosshair':''}`} onClick={!isPrint?(e)=>handleGraphClick(e,ear):undefined}>
        <rect x={padding.left} y={padding.top} width={graphWidth} height={graphHeight} fill={isPrint?"white":"#f8fafc"} />
        {Array.from({ length: 14 }).map((_, i) => { const y = getY(minDb + i*10); return <g key={i}><line x1={padding.left} y1={y} x2={width-padding.right} y2={y} stroke={i%2===1?"#e2e8f0":"#f1f5f9"} strokeWidth="1" /><text x={padding.left-10} y={y+4} textAnchor="end" fontSize="10" fill="#94a3b8" fontWeight="500">{minDb+i*10}</text></g>; })}
        {freqsToUse.map((f, i) => <g key={i}><line x1={getX(i)} y1={padding.top} x2={getX(i)} y2={height-padding.bottom} stroke="#e2e8f0" /><text x={getX(i)} y={padding.top-15} textAnchor="middle" fontSize="10" fontWeight="700" fill="#64748b">{f>=1000?f/1000+'k':f}</text></g>)}
        <text x={width/2} y={height-5} textAnchor="middle" fontSize="10" fill="#94a3b8" fontWeight="bold" style={{textTransform:'uppercase', letterSpacing:'0.05em'}}>Frequência (Hz)</text>
        <text transform={`rotate(-90 ${15} ${height/2})`} x={15} y={height/2} textAnchor="middle" fontSize="10" fill="#94a3b8" fontWeight="bold" style={{textTransform:'uppercase', letterSpacing:'0.05em'}}>Intensidade (dB HL)</text>
        <text x={width/2} y={15} textAnchor="middle" fontSize="13" fill={color} fontWeight="800" style={{textTransform: 'uppercase', letterSpacing:'0.05em'}}>Orelha {isRight ? 'Direita' : 'Esquerda'}</text>
        {renderL(boneData, color, 'bone')} {renderL(airData, color, 'air')} {renderS(boneData, 'bone')} {renderS(airData, 'air')}
      </svg>
    );
  };

  if(!termsAccepted){return <TermsModal onAgree={()=>setTermsAccepted(true)} />;}

  return (
    <div className="min-h-screen bg-slate-50 p-6 font-sans text-slate-800 print:bg-white print:p-0">
      {activeModal==='masking' && <AdvancedCalculator initialTab="masking" onClose={()=>setActiveModal(null)} />}
      {activeModal==='diagnosis' && <AdvancedCalculator initialTab="diagnosis" onClose={()=>setActiveModal(null)} />}
      {activeModal==='print' && <PrintOptionsModal onClose={()=>setActiveModal(null)} />}
      
      <div className="max-w-6xl mx-auto space-y-8 no-print">
        <div className="flex justify-between items-center bg-gradient-to-r from-medical-800 to-sky-800 p-6 rounded-2xl shadow-xl border border-white/10">
          <h1 className="text-2xl font-bold flex items-center gap-3 text-white tracking-tight"><Activity className="text-medical-100" size={28}/> AudioWEB PRO (Beta)</h1>
          <div className="flex gap-2 flex-wrap justify-end">
            <a href="https://fonoaudiologia.org.br/wp-content/uploads/2023/11/Guia-de-Orientacao-na-Avaliacao-Audiologica-DIGITAL-COMPLETO-FINAL.pdf" target="_blank" rel="noopener noreferrer" className="px-4 py-2.5 text-sm font-medium text-white bg-white/10 hover:bg-white/20 rounded-lg flex items-center gap-2 transition-all border border-white/20 no-underline" title="Guia CFFa"><BookOpen size={16}/> Guia CFFa</a>
            <button onClick={()=>setActiveModal('masking')} className="px-4 py-2.5 text-sm font-medium text-white bg-white/10 hover:bg-white/20 rounded-lg flex items-center gap-2 transition-all border border-white/20"><Calculator size={16}/> Mascaramento</button>
            <button onClick={()=>setActiveModal('diagnosis')} className="px-4 py-2.5 text-sm font-medium text-white bg-white/10 hover:bg-white/20 rounded-lg flex items-center gap-2 transition-all border border-white/20"><Stethoscope size={16}/> Diagnóstico</button>
            <button onClick={resetAll} className="px-4 py-2.5 text-sm font-medium text-white bg-white/10 hover:bg-red-500/30 rounded-lg flex items-center gap-2 transition-all border border-white/20"><RotateCcw size={16}/> Limpar</button>
            <button onClick={()=>setActiveModal('print')} className="px-6 py-2.5 text-sm font-bold text-medical-800 bg-white hover:bg-slate-100 rounded-lg flex items-center gap-2 shadow-lg transition-all transform hover:-translate-y-0.5"><Printer size={16}/> Imprimir</button>
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div className="bg-white p-6 rounded-2xl shadow-md border border-slate-100">
            <h3 className="text-xs font-bold text-medical-600 uppercase tracking-widest mb-6 flex items-center gap-2 border-b border-slate-100 pb-3"><User size={16}/> Identificação do Paciente</h3>
            <div className="space-y-5">
              <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Nome Completo</label><input type="text" className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-medical-500 focus:border-medical-500 transition-all outline-none text-slate-700 font-medium" placeholder="Nome do paciente" value={patientData.name} onChange={e=>setPatientData({...patientData,name:e.target.value})} /></div>
              <div className="grid grid-cols-3 gap-4">
                <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Nascimento</label><input type="date" className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-medical-500 outline-none text-slate-600" value={patientData.dob} onChange={e=>setPatientData({...patientData,dob:e.target.value})} /></div>
                <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Idade</label><input type="text" readOnly className="w-full p-2.5 bg-slate-100 border border-slate-200 rounded-lg text-sm text-center font-bold text-slate-600" value={patientData.age} /></div>
                <div>
                  <label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Gênero</label>
                  <select className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-medical-500 outline-none text-slate-600" value={patientData.gender} onChange={e=>setPatientData({...patientData,gender:e.target.value})}>
                    <option value="" disabled>Selecione</option><option value="Feminino">Feminino</option><option value="Masculino">Masculino</option><option value="Outro">Outro</option>
                  </select>
                </div>
              </div>
              <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Data Exame</label><input type="date" className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-medical-500 outline-none text-slate-600" value={patientData.examDate} onChange={e=>setPatientData({...patientData,examDate:e.target.value})} /></div>
            </div>
          </div>
          <div className="bg-white p-6 rounded-2xl shadow-md border border-slate-100">
            <h3 className="text-xs font-bold text-medical-600 uppercase tracking-widest mb-6 flex items-center gap-2 border-b border-slate-100 pb-3"><Settings size={16}/> Dados Técnicos</h3>
            <div className="space-y-5">
              <div className="grid grid-cols-2 gap-4">
                <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Audiômetro</label><input className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-medical-500 outline-none" value={equipmentData.audiometerModel} onChange={e=>setEquipmentData({...equipmentData,audiometerModel:e.target.value})} /></div>
                <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Calibração</label><input type="date" className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-medical-500 outline-none" value={equipmentData.audiometerCalib} onChange={e=>setEquipmentData({...equipmentData,audiometerCalib:e.target.value})} /></div>
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Imitanciômetro</label><input className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-medical-500 outline-none" value={equipmentData.immitanceModel} onChange={e=>setEquipmentData({...equipmentData,immitanceModel:e.target.value})} /></div>
                <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Calibração</label><input type="date" className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-medical-500 outline-none" value={equipmentData.immitanceCalib} onChange={e=>setEquipmentData({...equipmentData,immitanceCalib:e.target.value})} /></div>
              </div>
              <div className="pt-4 border-t border-slate-100 flex gap-3">
                <div className="flex-1"><label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Fonoaudiólogo(a)</label><input type="text" className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-medical-500 outline-none font-medium" value={professionalData.name} onChange={e=>setProfessionalData({...professionalData,name:e.target.value})} /></div>
                <div className="w-32"><label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">CRFa</label><input type="text" className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-medical-500 outline-none" value={professionalData.crfa} onChange={e=>setProfessionalData({...professionalData,crfa:e.target.value})} /></div>
              </div>
            </div>
          </div>
        </div>

        <div className="flex flex-col gap-8">
          <div className="bg-white p-6 rounded-2xl shadow-md border border-slate-100">
            <div className="flex gap-4 mb-6 justify-between items-center border-b border-slate-100 pb-4">
              <div className="flex items-center gap-4">
                <span className="text-sm font-bold text-slate-600 flex items-center gap-2 uppercase tracking-wide"><BarChart3 className="w-4 h-4 text-medical-600"/> Entrada Gráfica</span>
                <button onClick={()=>setMaskingMode(!maskingMode)} className={`text-xs px-4 py-1.5 rounded-full border transition-all flex items-center gap-2 font-medium ${maskingMode?'bg-amber-100 text-amber-800 border-amber-300 shadow-sm':'bg-slate-50 text-slate-500 border-slate-200 hover:bg-slate-100'}`}>{maskingMode?<CheckSquare size={14}/>:<Square size={14}/>} Modo Mascaramento</button>
                <button onClick={()=>setNoResponseMode(!noResponseMode)} className={`text-xs px-4 py-1.5 rounded-full border transition-all flex items-center gap-2 font-medium ${noResponseMode?'bg-red-100 text-red-800 border-red-300 shadow-sm':'bg-slate-50 text-slate-500 border-slate-200 hover:bg-slate-100'}`}>{noResponseMode?<ArrowDownLeft size={14}/>:<ArrowDown size={14}/>} Ausência</button>
                <label className="flex items-center gap-2 text-xs font-medium text-slate-600 cursor-pointer select-none"><input type="checkbox" checked={showIntermediates} onChange={(e)=>setShowIntermediates(e.target.checked)} className="w-4 h-4 accent-medical-600 rounded"/> Mostrar Freq. Intermediárias</label>
              </div>
              <div className="flex bg-slate-100 p-1 rounded-xl">
                <button onClick={()=>setStimulusType('air')} className={`px-4 py-1.5 text-xs font-bold uppercase tracking-wide rounded-lg transition-all ${stimulusType==='air'?'bg-white shadow-sm text-medical-700':'text-slate-400 hover:text-slate-600'}`}>Via Aérea</button>
                <button onClick={()=>setStimulusType('bone')} className={`px-4 py-1.5 text-xs font-bold uppercase tracking-wide rounded-lg transition-all ${stimulusType==='bone'?'bg-white shadow-sm text-medical-700':'text-slate-400 hover:text-slate-600'}`}>Via Óssea</button>
              </div>
            </div>
            <div className="flex flex-col md:flex-row gap-8 justify-center">
              <div className="flex-1 max-w-[500px]">
                <div className="border border-slate-200 rounded-xl bg-white overflow-hidden shadow-inner p-1"><SingleAudiogramGraph ear="right"/></div>
                <div className="text-center mt-3 text-xs font-bold uppercase tracking-widest text-red-600 bg-red-50 py-1.5 rounded-lg border border-red-100">Média Tritonal (500-2k): {calculateTritonal_Average(rightAir,'right')?.toFixed(1)||'--'} dB</div>
              </div>
              <div className="flex-1 max-w-[500px]">
                <div className="border border-slate-200 rounded-xl bg-white overflow-hidden shadow-inner p-1"><SingleAudiogramGraph ear="left"/></div>
                <div className="text-center mt-3 text-xs font-bold uppercase tracking-widest text-blue-600 bg-blue-50 py-1.5 rounded-lg border border-blue-100">Média Tritonal (500-2k): {calculateTritonal_Average(leftAir,'left')?.toFixed(1)||'--'} dB</div>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-2xl shadow-md border border-slate-100 flex flex-col overflow-hidden min-h-[500px]">
            <div className="flex border-b border-slate-200 bg-slate-50/50">
              {[{id:'tonal',label:'Audiometria Tonal'},{id:'logo',label:'Logoaudiometria'},{id:'immitance',label:'Imitânciometria'},{id:'weber',label:'Weber'}].map(tab=>(
                <button key={tab.id} onClick={()=>setActiveTab(tab.id)} className={`flex-1 py-4 text-sm font-bold uppercase tracking-wider transition-all ${activeTab===tab.id?'text-medical-700 border-b-2 border-medical-600 bg-white':'text-slate-400 hover:text-slate-600 hover:bg-slate-100'}`}>{tab.label}</button>
              ))}
            </div>
            <div className="overflow-y-auto flex-1 p-8">
              {activeTab==='tonal' && (
                <div className="space-y-8">
                  {['air','bone'].map(type=>(
                    <div key={type} className="bg-slate-50/50 rounded-xl p-4 border border-slate-100">
                      <h4 className="text-xs font-bold text-medical-700 uppercase mb-4 flex items-center gap-2"><Activity size={14}/> Via {type==='air'?'Aérea':'Óssea'}</h4>
                      <div className="overflow-x-auto">
                        <table className="w-full text-center text-xs">
                          <thead><tr><th></th>{currentFrequencies.map(f=><th key={f} className={`p-2 font-bold text-slate-400 ${type==='bone'&&!boneFrequencies.includes(f)?'opacity-30':''}`}>{f}</th>)}</tr></thead>
                          <tbody className="divide-y divide-slate-200/50">
                            <tr className="bg-white">
                              <td className="font-bold text-red-600 p-2 text-left pl-4">OD</td>
                              {currentFrequencies.map(f=>{
                                const isNr=isFreqAbsent(type==='air'?rightAir:rightBone,f,'right',type);
                                return (
                                  <td key={f} className="p-1 relative">
                                    <input disabled={type==='bone'&&!boneFrequencies.includes(f)} className={`w-full text-center p-1.5 rounded text-slate-700 font-medium ${type==='bone'&&!boneFrequencies.includes(f)?'bg-slate-100':'bg-transparent focus:bg-slate-50'}`} type="number" step="5" value={type==='air'?rightAir[f]??'':rightBone[f]??''} onChange={e=>updateTonalPoint('right',type,f,e.target.value)} />
                                    {isNr && <span className="absolute top-1 right-1 text-[8px] text-red-500 font-bold">↓</span>}
                                  </td>
                                );
                              })}
                            </tr>
                            <tr className="bg-white">
                              <td className="font-bold text-blue-600 p-2 text-left pl-4">OE</td>
                              {currentFrequencies.map(f=>{
                                const isNr=isFreqAbsent(type==='air'?leftAir:leftBone,f,'left',type);
                                return (
                                  <td key={f} className="p-1 relative">
                                    <input disabled={type==='bone'&&!boneFrequencies.includes(f)} className={`w-full text-center p-1.5 rounded text-slate-700 font-medium ${type==='bone'&&!boneFrequencies.includes(f)?'bg-slate-100':'bg-transparent focus:bg-slate-50'}`} type="number" step="5" value={type==='air'?leftAir[f]??'':leftBone[f]??''} onChange={e=>updateTonalPoint('left',type,f,e.target.value)} />
                                    {isNr && <span className="absolute top-1 right-1 text-blue-500 font-bold">↓</span>}
                                  </td>
                                );
                              })}
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  ))}
                </div>
              )}
              {activeTab==='logo' && (
                <div className="space-y-6">
                  {['right','left'].map(side=>(
                    <div key={side} className={`p-6 border rounded-xl bg-white shadow-sm ${side==='right'?'border-red-100':'border-blue-100'}`}>
                      <h4 className={`text-sm font-bold uppercase mb-4 flex items-center gap-2 ${side==='right'?'text-red-600':'text-blue-600'}`}><Ear size={16}/> Orelha {side==='right'?'Direita':'Esquerda'}</h4>
                      <div className="grid grid-cols-3 gap-6 mb-6">
                        <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wide block mb-1">SRT (dB)</label><input type="number" className="w-full p-2 border border-slate-200 rounded-lg text-sm font-medium" value={logoData[side].srt} onChange={e=>setLogoData({...logoData,[side]:{...logoData[side],srt:e.target.value}})} /></div>
                        <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wide block mb-1">SDT (dB)</label><input type="number" className="w-full p-2 border border-slate-200 rounded-lg text-sm font-medium" value={logoData[side].sdt} onChange={e=>setLogoData({...logoData,[side]:{...logoData[side],sdt:e.target.value}})} /></div>
                        <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wide block mb-1">Mascaramento</label><input type="number" className="w-full p-2 border border-slate-200 rounded-lg text-sm font-medium bg-slate-50" value={logoData[side].masking} onChange={e=>setLogoData({...logoData,[side]:{...logoData[side],masking:e.target.value}})} /></div>
                      </div>
                      <div className="bg-slate-50 p-4 rounded-xl border border-slate-100">
                        <div className="text-xs font-bold text-slate-500 uppercase mb-3 border-b border-slate-200 pb-2">Índice Percentual de Fala (IPRF)</div>
                        <div className="grid grid-cols-2 gap-8">
                          <div className="flex gap-3">
                            <div className="flex-1"><label className="text-[10px] font-bold text-slate-400 uppercase block mb-1">Monossílabos (%)</label><input type="number" className="w-full p-2 border border-slate-200 rounded-lg bg-white" value={logoData[side].ipfrMono} onChange={e=>setLogoData({...logoData,[side]:{...logoData[side],ipfrMono:e.target.value}})} /></div>
                            <div className="w-20"><label className="text-[10px] font-bold text-slate-400 uppercase block mb-1">dB</label><input type="number" className="w-full p-2 border border-slate-200 rounded-lg bg-white" value={logoData[side].ipfrMonoLevel} onChange={e=>setLogoData({...logoData,[side]:{...logoData[side],ipfrMonoLevel:e.target.value}})} /></div>
                          </div>
                          <div className="flex gap-3">
                            <div className="flex-1"><label className="text-[10px] font-bold text-slate-400 uppercase block mb-1">Dissílabos (%)</label><input type="number" className="w-full p-2 border border-slate-200 rounded-lg bg-white" value={logoData[side].ipfrDi} onChange={e=>setLogoData({...logoData,[side]:{...logoData[side],ipfrDi:e.target.value}})} /></div>
                            <div className="w-20"><label className="text-[10px] font-bold text-slate-400 uppercase block mb-1">dB</label><input type="number" className="w-full p-2 border border-slate-200 rounded-lg bg-white" value={logoData[side].ipfrDiLevel} onChange={e=>setLogoData({...logoData,[side]:{...logoData[side],ipfrDiLevel:e.target.value}})} /></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
              {activeTab==='immitance' && (
                <div className="space-y-8">
                  <div className="bg-slate-50 p-6 rounded-xl border border-slate-100 flex justify-center"><div className="w-full max-w-[600px]"><TympanogramGraph dataR={immitanceData.right} dataL={immitanceData.left} /></div></div>
                  <div className="grid grid-cols-2 gap-6">
                    {['right','left'].map(side=>{
                      const vPeak=parseNum(immitanceData[side].peakVol);const v200=parseNum(immitanceData[side].vol200);const statComp=(vPeak&&v200)?(vPeak-v200).toFixed(2):'-';
                      return(
                        <div key={side} className={`border p-5 rounded-xl bg-white shadow-sm ${side==='right'?'border-red-100':'border-blue-100'}`}>
                          <div className={`text-sm font-bold mb-4 uppercase tracking-wide flex items-center gap-2 ${side==='right'?'text-red-600':'text-blue-600'}`}><Ear size={16}/> {side==='right'?'Direita':'Esquerda'}</div>
                          <div className="space-y-3">
                            <div className="flex justify-between items-center"><label className="text-xs font-bold text-slate-400 uppercase">Pressão (dPa)</label><input className="w-20 text-sm p-1.5 border border-slate-200 rounded-lg text-center font-medium" value={immitanceData[side].pressure} onChange={e=>setImmitanceData(p=>({...p,[side]:{...p[side],pressure:e.target.value}}))} /></div>
                            <div className="flex justify-between items-center"><label className="text-xs font-bold text-slate-400 uppercase">Volume de Pico</label><input className="w-20 text-sm p-1.5 border border-slate-200 rounded-lg text-center font-medium" value={immitanceData[side].peakVol} onChange={e=>setImmitanceData(p=>({...p,[side]:{...p[side],peakVol:e.target.value}}))} /></div>
                            <div className="flex justify-between items-center"><label className="text-xs font-bold text-slate-400 uppercase">Volume em +200</label><input className="w-20 text-sm p-1.5 border border-slate-200 rounded-lg text-center font-medium" value={immitanceData[side].vol200} onChange={e=>setImmitanceData(p=>({...p,[side]:{...p[side],vol200:e.target.value}}))} /></div>
                            <div className="flex justify-between items-center pt-3 border-t border-slate-100 mt-2"><label className="text-xs font-bold text-slate-700 uppercase">Posição Neutra</label><span className="w-20 text-sm font-bold text-right text-medical-600">{statComp}</span></div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  <div className="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                    <h4 className="text-xs font-bold text-slate-500 uppercase p-4 bg-slate-50 border-b border-slate-100">Reflexos Acústicos</h4>
                    <div className="p-4 grid gap-6">
                      {['right','left'].map(ear=>(
                        <div key={ear}>
                          <div className={`text-xs font-bold mb-2 uppercase tracking-wide ${ear==='right'?'text-red-600':'text-blue-600'}`}>Orelha {ear==='right'?'Direita':'Esquerda'}</div>
                          <table className="w-full text-center text-xs border border-slate-100 rounded-lg overflow-hidden">
                            <thead><tr className="bg-slate-50 text-slate-500"><th className="p-2 border-r border-slate-100 w-24 text-left pl-4 font-bold">Modo</th><th className="p-2 border-r border-slate-100 font-bold">500</th><th className="p-2 border-r border-slate-100 font-bold">1k</th><th className="p-2 border-r border-slate-100 font-bold">2k</th><th className="p-2 font-bold">4k</th></tr></thead>
                            <tbody className="divide-y divide-slate-100">
                              {['contra','ipsi','threshold'].map(mode=>(
                                <tr key={mode}>
                                  <td className="font-semibold text-left pl-4 border-r border-slate-100 py-2 text-slate-600 capitalize">{mode==='threshold'?'Limiar (VA)':mode}</td>
                                  {[500,1000,2000,4000].map(f=>{
                                    if(mode==='threshold'){const val=ear==='right'?rightAir[f]:leftAir[f];return<td key={f} className="border-r border-slate-100 last:border-0 align-middle bg-slate-50/50 text-slate-500 font-medium">{val!==null?val:'-'}</td>}
                                    return <td key={f} className="border-r border-slate-100 last:border-0 align-middle"><input className="w-full text-center p-1 outline-none bg-transparent hover:bg-slate-50 transition-colors" placeholder="-" value={immitanceData.reflexes[ear][mode][f]} onChange={(e)=>{
                                        const val=e.target.value;
                                        setImmitanceData(prev => {
                                            const earData = { ...prev.reflexes[ear] };
                                            earData[mode] = { ...earData[mode], [f]: val };
                                            return { ...prev, reflexes: { ...prev.reflexes, [ear]: earData } };
                                        });
                                    }} /></td>
                                  })}
                                </tr>
                              ))}
                              <tr className="bg-slate-50 font-bold text-slate-700">
                                <td className="text-left pl-4 py-2 border-r border-slate-100">Diferença</td>
                                {[500,1000,2000,4000].map(f=>{
                                  const thr=ear==='right'?rightAir[f]:leftAir[f];const refVal=immitanceData.reflexes[ear].contra[f];const ref=parseNum(refVal);
                                  if(refVal==='0'||refVal?.toLowerCase()==='aus'||ref===null||thr===null) return <td key={f} className="border-r border-slate-100 last:border-0 text-slate-400">-</td>;
                                  return <td key={f} className="border-r border-slate-100 last:border-0">{Math.abs(thr-ref)}</td>
                                })}
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              )}
              {activeTab==='weber' && (
                <div className="space-y-6">
                  <div className="bg-white rounded-xl p-6 border border-slate-200">
                    <h4 className="text-sm font-bold text-slate-600 uppercase mb-4 flex items-center gap-2"><MoveHorizontal size={16}/> Teste de Weber</h4>
                    <div className="overflow-x-auto">
                      <table className="w-full text-center">
                        <thead><tr className="bg-slate-50 text-slate-500 text-xs uppercase"><th className="p-3 border-b">Frequência (Hz)</th>{weberFrequencies.map(f=><th key={f} className="p-3 border-b">{f}</th>)}</tr></thead>
                        <tbody>
                          <tr>
                            <td className="p-3 font-bold text-slate-700 border-r bg-slate-50">Lateralização</td>
                            {weberFrequencies.map(f=>(
                              <td key={f} className="p-2 border-r last:border-r-0">
                                <div className="flex justify-center gap-2">
                                  <button onClick={()=>updateWeber(f,'left')} className={`p-1.5 rounded hover:bg-blue-50 transition-colors ${weberData[f]==='left'?'text-blue-600 bg-blue-100 ring-2 ring-blue-200':'text-slate-300'}`} title="Lateraliza Esquerda"><MoveLeft size={18} strokeWidth={3}/></button>
                                  <button onClick={()=>updateWeber(f,'center')} className={`p-1.5 rounded hover:bg-slate-100 transition-colors ${weberData[f]==='center'?'text-slate-700 bg-slate-200 ring-2 ring-slate-300':'text-slate-300'}`} title="Indiferente / Centro"><div className="w-4 h-4 rounded-full border-2 border-current"></div></button>
                                  <button onClick={()=>updateWeber(f,'right')} className={`p-1.5 rounded hover:bg-red-50 transition-colors ${weberData[f]==='right'?'text-red-600 bg-red-100 ring-2 ring-red-200':'text-slate-300'}`} title="Lateraliza Direita"><MoveRight size={18} strokeWidth={3}/></button>
                                </div>
                                <div className="text-[10px] mt-1 font-bold text-slate-500 h-4">{weberData[f]==='left'?'ESQUERDA':weberData[f]==='right'?'DIREITA':weberData[f]==='center'?'INDIFERENTE':''}</div>
                              </td>
                            ))}
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>

        <div className="bg-white p-6 rounded-2xl shadow-md border border-slate-100">
          <h3 className="text-xs font-bold text-medical-600 uppercase tracking-widest mb-6 flex items-center gap-2 border-b border-slate-100 pb-3"><Clipboard size={16}/> Parecer Fonoaudiológico</h3>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-2">Conclusão / Laudo</label><textarea className="w-full h-40 p-4 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-medical-500 outline-none resize-none bg-slate-50 leading-relaxed" value={clinicalNotes.laudo} onChange={e=>setClinicalNotes({...clinicalNotes,laudo:e.target.value})}></textarea></div>
            <div><label className="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-2">Observações e Encaminhamentos</label><textarea className="w-full h-40 p-4 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-medical-500 outline-none resize-none bg-slate-50 leading-relaxed" value={clinicalNotes.observations} onChange={e=>setClinicalNotes({...clinicalNotes,observations:e.target.value})}></textarea></div>
          </div>
        </div>
      </div>

      <div className="print-only print-container text-black text-xs font-sans max-w-[210mm] mx-auto min-h-screen">
        <div className="print-content">
          <div className="border-b-2 border-slate-800 pb-4 mb-6">
            <div className="flex justify-between items-end mb-2">
              <h1 className="text-2xl font-bold uppercase tracking-widest text-slate-900">Avaliação Audiológica</h1>
              <div className="text-right text-[10px] text-slate-500"><div>Gerado em {new Date().toLocaleDateString()}</div><div className="font-bold mt-1">DATA DO EXAME: {formatDate(patientData.examDate)}</div></div>
            </div>
            <div className="border border-slate-400 flex rounded-sm overflow-hidden">
              <div className="flex-1 p-3 border-r border-slate-400">
                <div className="grid grid-cols-[100px_1fr] gap-y-1">
                  <span className="font-bold text-slate-600 uppercase">Nome:</span> <span className="font-semibold text-slate-900">{patientData.name}</span>
                  <span className="font-bold text-slate-600 uppercase">DN / Idade / Sexo:</span> <span className="font-semibold text-slate-900">{patientData.dob?new Date(patientData.dob).toLocaleDateString():''} ({patientData.age} anos) - {patientData.gender}</span>
                </div>
              </div>
              <div className="w-[45%] p-3 bg-slate-50">
                <div className="grid grid-cols-[100px_1fr] gap-y-1 text-[10px]">
                  <span className="font-bold text-slate-500 uppercase">Audiômetro:</span> <span>{equipmentData.audiometerModel} {equipmentData.audiometerCalib?`(Cal: ${formatDate(equipmentData.audiometerCalib)})`:''}</span>
                  <span className="font-bold text-slate-500 uppercase">Imitâncio:</span> <span>{equipmentData.immitanceModel} {equipmentData.immitanceCalib?`(Cal: ${formatDate(equipmentData.immitanceCalib)})`:''}</span>
                </div>
              </div>
            </div>
          </div>

          {printConfig.tonal && (
            <div className="mb-6 page-break-inside-avoid">
              <div className="flex gap-6">
                <div className="flex-1 border border-slate-300 p-2 rounded h-[260px]"><SingleAudiogramGraph ear="right" isPrint={true}/></div>
                <div className="flex-1 border border-slate-300 p-2 rounded h-[260px]"><SingleAudiogramGraph ear="left" isPrint={true}/></div>
              </div>
              <div className="flex justify-between text-[10px] bg-slate-50 p-2 rounded border border-slate-200 mt-2">
                <div><span className="font-bold text-red-700 uppercase">OD (Média 500-4k):</span> {calculateWHO2021_Average(rightAir,'right')?.toFixed(1)||'--'} dB</div>
                <div><span className="font-bold text-blue-700 uppercase">OE (Média 500-4k):</span> {calculateWHO2021_Average(leftAir,'left')?.toFixed(1)||'--'} dB</div>
              </div>
            </div>
          )}

          <div className="flex gap-6 h-auto">
            <div className="flex-1 flex flex-col gap-4">
              {printConfig.immitance && (
                <div className="border border-slate-300 rounded overflow-hidden page-break-inside-avoid">
                  <div className="bg-slate-100 p-1.5 text-center font-bold text-[10px] border-b border-slate-300 uppercase tracking-wider">Reflexos Acústicos (dB)</div>
                  <div className="flex">
                    {['right','left'].map(ear=>(
                      <div key={ear} className="flex-1 border-r last:border-0 border-slate-300">
                        <div className={`text-center font-bold border-b border-slate-300 bg-white py-1 uppercase text-[9px] ${ear==='right'?'text-red-700':'text-blue-700'}`}>{ear==='right'?'OD':'OE'}</div>
                        <table className="w-full text-center text-[9px]">
                          <thead><tr className="border-b border-slate-200 bg-slate-50 text-slate-500 uppercase"><th className="py-1">Modo</th><th>500</th><th>1k</th><th>2k</th><th>4k</th></tr></thead>
                          <tbody className="divide-y divide-slate-100">
                            {['contra','ipsi','threshold'].map(mode=>(
                              <tr key={mode} className="border-b border-slate-100">
                                <td className="font-bold text-left pl-2 py-1 text-slate-600 capitalize bg-slate-50/50">{mode==='threshold'?'Limiar':mode}</td>
                                {[500,1000,2000,4000].map(f=>{
                                  if(mode==='threshold'){const val=ear==='right'?rightAir[f]:leftAir[f];return<td key={f} className="border-r border-gray-100 last:border-0 align-middle bg-slate-50">{val!==null?val:'-'}</td>}
                                  const val=immitanceData.reflexes[ear][mode][f];const color=ear==='right'?'text-red-600':'text-blue-600';
                                  if(val==='0'||val?.toLowerCase()==='aus'){return(<td key={f} className="border-r border-gray-100 last:border-0 align-middle"><div className={`flex items-center justify-center gap-0.5 font-bold ${color} text-[9px]`}>AUS<ArrowDown size={10} strokeWidth={2.5}/></div></td>)}
                                  return <td key={f} className="border-r border-gray-100 last:border-0 align-middle">{val}</td>
                                })}
                              </tr>
                            ))}
                            <tr className="bg-slate-50 font-bold">
                              <td className="text-left pl-2 py-1 uppercase text-[8px]">Dif</td>
                              {[500,1000,2000,4000].map(f=>{const thr=ear==='right'?rightAir[f]:leftAir[f];const refVal=immitanceData.reflexes[ear].contra[f];const ref=parseNum(refVal);if(refVal==='0'||refVal?.toLowerCase()==='aus'||ref===null||thr===null)return<td key={f} className="border-l border-slate-200 text-slate-400">-</td>;return<td key={f} className="border-l border-slate-200 text-slate-700">{Math.abs(thr-ref)}</td>})}
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
            <div className="w-[40%] flex flex-col gap-4">
              {printConfig.immitance && (
                <div className="border border-slate-300 p-2 rounded page-break-inside-avoid">
                  <div className="h-[90px] w-full mb-2"><TympanogramGraph dataR={immitanceData.right} dataL={immitanceData.left}/></div>
                  <div className="grid grid-cols-2 text-[8px] gap-2 leading-tight">
                    {['right','left'].map(side=>{
                      const vPeak=parseNum(immitanceData[side].peakVol);const v200=parseNum(immitanceData[side].vol200);const statComp=(vPeak&&v200)?(vPeak-v200).toFixed(2):'-';
                      return(<div key={side} className="bg-slate-50 p-1.5 rounded border border-slate-100"><span className={`${side==='right'?'text-red-700':'text-blue-700'} font-bold block uppercase mb-1`}>{side==='right'?'OD':'OE'}</span><span className="block text-slate-500">Pressão: <b className="text-slate-800">{immitanceData[side].pressure||'-'}</b></span><span className="block text-slate-500">Vol.Pico: <b className="text-slate-800">{immitanceData[side].peakVol||'-'}</b></span><span className="block text-slate-500">Estática: <b className="text-slate-800">{statComp}</b></span></div>)
                    })}
                  </div>
                </div>
              )}
              {printConfig.logo && (
                <div className="border border-slate-300 rounded overflow-hidden page-break-inside-avoid">
                  <table className="w-full text-center text-[9px]">
                    <thead className="bg-slate-100 font-bold text-slate-600 uppercase border-b border-slate-300"><tr><th className="p-1.5 text-left">Logo</th><th>SRT</th><th>SDT</th><th>Mono</th><th>Dissí</th></tr></thead>
                    <tbody>
                      <tr className="border-b border-slate-200"><td className="font-bold text-red-600 p-1.5 text-left bg-slate-50">OD</td><td>{logoData.right.srt}</td><td>{logoData.right.sdt}</td><td>{logoData.right.ipfrMono}%</td><td>{logoData.right.ipfrDi}%</td></tr>
                      <tr><td className="font-bold text-blue-600 p-1.5 text-left bg-slate-50">OE</td><td>{logoData.left.srt}</td><td>{logoData.left.sdt}</td><td>{logoData.left.ipfrMono}%</td><td>{logoData.left.ipfrDi}%</td></tr>
                    </tbody>
                  </table>
                </div>
              )}
            </div>
          </div>

          {printConfig.weber && Object.values(weberData).some(v=>v) && (
            <div className="mt-4 border border-slate-300 rounded overflow-hidden page-break-inside-avoid">
              <div className="bg-slate-100 p-1 text-center font-bold text-[10px] border-b border-slate-300 uppercase tracking-wider">Teste de Weber</div>
              <table className="w-full text-center text-[9px]">
                <thead><tr className="bg-white border-b border-slate-200">{weberFrequencies.map(f=><th key={f} className="p-1 border-r last:border-r-0">{f} Hz</th>)}</tr></thead>
                <tbody><tr>{weberFrequencies.map(f=>(<td key={f} className="p-1 border-r last:border-r-0 font-bold">{weberData[f]==='left'?<span className="text-blue-700">← ESQ</span>:weberData[f]==='right'?<span className="text-red-700">DIR →</span>:weberData[f]==='center'?<span className="text-slate-700">= INDIF</span>:'-'}</td>))}</tr></tbody>
              </table>
            </div>
          )}

          {printConfig.report && (
            <div className="mt-4 border-t-2 border-slate-200 pt-2 page-break-inside-avoid">
              <div className="mb-3"><h4 className="font-bold text-[10px] uppercase text-slate-700 mb-1">Laudo Fonoaudiológico:</h4><p className="whitespace-pre-wrap text-[10px] leading-snug text-slate-900 font-medium">{clinicalNotes.laudo}</p></div>
              <div><h4 className="font-bold text-[10px] uppercase text-slate-700 mb-1">Observações:</h4><p className="whitespace-pre-wrap text-[10px] leading-snug text-slate-900">{clinicalNotes.observations}</p></div>
            </div>
          )}
        </div>
        <div className="print-footer page-break-inside-avoid w-full flex justify-center">
          <div className="text-center w-72">
            <div className="border-t border-slate-900 mb-2 w-full"></div>
            <div className="font-bold text-[12px] uppercase text-slate-900">{professionalData.name}</div>
            <div className="text-[10px] text-slate-600">Fonoaudiólogo(a) - CRFa: {professionalData.crfa}</div>
          </div>
        </div>
      </div>
    </div>
  );
};

const root = createRoot(document.getElementById('root'));
root.render(<AudiogramApp />);
</script>
</body>
</html>
